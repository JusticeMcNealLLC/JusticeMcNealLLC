<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Set new password — Justice McNeal LLC</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-dvh grid place-items-center bg-slate-50">
  <main class="w-full max-w-md rounded-2xl bg-white/90 p-6 ring-1 ring-black/5 shadow">
    <h1 class="text-lg font-semibold">Set a new password</h1>
    <p class="mt-1 text-sm text-slate-600">You’re signed in via a recovery link.</p>

    <form id="resetForm" class="mt-4 space-y-3">
      <label class="block">
        <span class="mb-1 block text-sm text-slate-600">New password</span>
        <input id="pw1" type="password" minlength="8" required
               class="w-full rounded-lg border border-slate-300 px-3 py-2 text-sm focus:ring-4 focus:ring-indigo-500/20 focus:border-indigo-500"
               placeholder="••••••••" />
      </label>
      <label class="block">
        <span class="mb-1 block text-sm text-slate-600">Confirm password</span>
        <input id="pw2" type="password" minlength="8" required
               class="w-full rounded-lg border border-slate-300 px-3 py-2 text-sm focus:ring-4 focus:ring-indigo-500/20 focus:border-indigo-500"
               placeholder="••••••••" />
      </label>

      <button class="w-full rounded-lg bg-indigo-600 py-2 text-sm font-medium text-white hover:bg-indigo-700">
        Update password
      </button>
    </form>

    <p id="msg" class="mt-3 text-sm"></p>

    <div class="mt-6 text-xs text-slate-500">
      <a class="hover:underline" href="/pages/login.html">Back to sign in</a>
    </div>
  </main>

  <script type="module" src="/js/shared/bootstrap.js"></script>
  <script type="module">
    const supa = window.supabaseClient;
    const form = document.getElementById('resetForm');
    const pw1 = document.getElementById('pw1');
    const pw2 = document.getElementById('pw2');
    const msg = document.getElementById('msg');

    form?.addEventListener('submit', async (e) => {
      e.preventDefault();
      msg.className = 'mt-3 text-sm text-slate-600';

      if (pw1.value !== pw2.value) {
        msg.className = 'mt-3 text-sm text-rose-600';
        msg.textContent = 'Passwords do not match.';
        return;
      }
      if (pw1.value.length < 8) {
        msg.className = 'mt-3 text-sm text-rose-600';
        msg.textContent = 'Use at least 8 characters.';
        return;
      }

      try {
        const { error } = await supa.auth.updateUser({ password: pw1.value });
        if (error) throw error;
        msg.textContent = 'Password updated. Redirecting to sign in…';
        setTimeout(() => { location.href = '/pages/login.html'; }, 1200);
      } catch (err) {
        msg.className = 'mt-3 text-sm text-rose-600';
        msg.textContent = 'Could not update password. Please try again.';
        console.error(err);
      }
    });
  </script>
</body>
</html>
