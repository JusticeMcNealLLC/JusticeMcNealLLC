<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Contribute • Justice McNeal LLC</title>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Poppins:wght@700&display=swap">
  <link rel="stylesheet" href="../assets/tailwind.css">
</head>

<body class="min-h-screen bg-[#f7f9fc] text-slate-900" data-page="contribute" data-require-auth="member">
  <div class="mx-auto max-w-5xl px-4 py-6 md:px-6">

    <!-- Optional navbar mount -->
    <div id="navMount" class="mb-4"></div>

    <!-- Stripe return banner -->
    <div id="statusBanner" class="hidden mb-4 card p-3 text-sm text-slate-700"></div>

<!-- Hero -->
<section class="hero bg-dots" aria-labelledby="pageTitle">
  <div class="flex items-center justify-between gap-8">
    <div class="min-w-0 w-full">

      <!-- SKELETON (shown first) -->
<div id="heroSkeleton" class="skel flex flex-col gap-3">
  <div class="skel-title"></div>
  <div class="skel-sub"></div>
  <div class="mt-2 flex gap-3">
    <div class="skel-btn w-56"></div>
    <div class="skel-btn w-44"></div>
  </div>
</div>


      <!-- CONTENT (hidden until user loads) -->
      <div id="heroContent" class="hidden">
        <h1 id="pageTitle" class="font-display text-3xl md:text-4xl">Contribute</h1>
        <p class="mt-2 text-slate-600">
          Signed in as <span id="whoami" class="font-medium" aria-live="polite">Loading…</span>
        </p>

        <!-- Main actions -->
        <div id="rowMainActions" class="actions-row">
          <button id="btnOpenConfirm" class="btn-primary">
            <span id="btnOpenConfirmText">Update Contribution</span>
          </button>
          <button id="btnBillingPortal" class="btn-light">Manage Billing</button>
        </div>

        <!-- Cancel state (only when cancel_at exists) -->
        <div id="rowCancelActions" class="actions-row hidden">
          <span id="cancelNote" class="badge-warning"></span>
          <button id="btnResume" class="btn-ghost">Cancel cancellation</button>
        </div>
      </div>
    </div>

    <!-- Illustration -->
    <div class="hidden md:block shrink-0">
      <svg class="w-48 h-48" viewBox="0 0 200 200" fill="none" aria-hidden="true">
        <rect x="36" y="70" width="120" height="70" rx="8" fill="#bfdbfe"/>
        <circle cx="84" cy="130" r="14" fill="#fde68a"/>
        <circle cx="112" cy="124" r="18" fill="#fbbf24"/>
        <path d="M40 130c18-12 38-6 52-18 14-12 22-40 44-40 10 0 18 6 24 16"
              stroke="#2563eb" stroke-width="4" fill="none"/>
        <path d="M140 78 l10 -16 l10 16 l-6 26 h-8z" fill="#f59e0b" stroke="#d97706" stroke-width="2"/>
      </svg>
    </div>
  </div>
</section>


<!-- Top stats: skeleton -->
<!-- Top stats: skeleton that matches the 3-pill layout -->
<div id="topSkeleton" class="mt-6 skel">
  <div class="stat-pills">
    <!-- Pill 1 -->
    <div class="stat-pill">
      <div class="skel-line h-3 w-24"></div>            <!-- label -->
      <div class="mt-3 skel-bar h-8 w-28"></div>        <!-- big value -->
      <div class="mt-2 skel-line h-3 w-40"></div>       <!-- "Default card" line -->
    </div>

    <!-- Pill 2 -->
    <div class="stat-pill">
      <div class="skel-line h-3 w-24"></div>            <!-- label -->
      <div class="mt-3 skel-bar h-8 w-28"></div>        <!-- big value -->
    </div>

    <!-- Pill 3 -->
    <div class="stat-pill">
      <div class="skel-line h-3 w-24"></div>            <!-- label -->
      <div class="mt-3 skel-bar h-8 w-28"></div>        <!-- big value -->
    </div>
  </div>
</div>



<!-- Real content -->
<div id="topContent" class="mt-6 hidden">
  <div class="stat-pills">
    <!-- your three pills -->
    <!-- Pill 1: Current pledge (+ default card) -->
    <div class="stat-pill">
      <div class="stat-label">Current pledge</div>
      <div class="stat-value">
        <span id="currentPledge">$—</span>
        <span class="text-lg font-medium opacity-70 align-top">/mo</span>
      </div>
      <div id="cardSummaryRow" class="hidden mt-2 text-sm text-slate-600">
        Default card: <span id="cardSummaryTxt" class="font-medium"></span>
      </div>
    </div>

    <!-- Pill 2 -->
    <div class="stat-pill">
      <div class="stat-label">Total contributed</div>
      <div id="totalContributed" class="stat-value">$—</div>
    </div>

    <!-- Pill 3 -->
    <div class="stat-pill">
      <div class="stat-label">Next billing</div>
      <div id="nextBillingDate" class="stat-value">—</div>
    </div>
  </div>
</div>




<!-- Set monthly contribution -->
<div class="card p-6 mt-6">
  <h2 class="text-lg font-semibold">Set monthly contribution</h2>
  <p class="text-sm text-slate-600">
    Use the presets or slider, then click <em>Update Contribution</em> above.
  </p>

  <!-- Controls row: slider + amount aligned -->
  <div class="mt-4 grid grid-cols-[1fr_auto] items-center gap-4">
    <input id="pledgeSlider" type="range" min="50" max="2000" step="10" class="w-full accent-blue">
    <label for="pledgeInput" class="sr-only">Amount</label>
    <div class="input-prefix">
      <span>$</span>
      <input id="pledgeInput" type="number" min="50" max="2000" step="10"
             class="w-28 rounded-xl border border-slate-300 pr-3 py-2 text-right"
             inputmode="numeric">
    </div>
  </div>

  <!-- Presets -->
  <div id="presetRow" class="mt-3 flex flex-wrap gap-2">
    <button type="button" data-preset="50"  class="chip">$50</button>
    <button type="button" data-preset="100" class="chip">$100</button>
    <button type="button" data-preset="250" class="chip">$250</button>
    <button type="button" data-preset="500" class="chip">$500</button>
  </div>

  <div id="amtError" class="hidden mt-2 text-sm text-rose-600">
    Minimum is $50. Maximum is $2,000.
  </div>
  <div id="saveMsg" class="mt-2 text-sm text-slate-600"></div>

  <ul class="mt-4 text-sm text-slate-600 list-disc list-inside">
    <li>Changes take effect on your next billing date.</li>
    <li>A default payment method is required for billing.</li>
    <li>You can cancel anytime from the billing portal.</li>
  </ul>
</div>


<!-- Projection -->
<div class="card p-6 mt-6">
  <!-- Header: title (left) + Horizon select (right) -->
  <div class="flex flex-wrap items-center justify-between gap-4">
    <h2 class="text-lg font-semibold">Projection</h2>

    <div class="flex items-center gap-3">
      <label for="projHorizon" class="text-sm text-slate-600">Horizon</label>
      <div class="select-wrap">
        <select id="projHorizon" name="horizon" class="select-native" aria-label="Projection horizon">
          <option value="3">3 months</option>
          <option value="6" selected>6 months</option>
          <option value="12">12 months</option>
        </select>
        <!-- custom caret -->
        <svg class="select-chevron" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
          <path fill-rule="evenodd"
                d="M5.23 7.21a.75.75 0 011.06.02L10 10.17l3.71-2.94a.75.75 0 111.02 1.1l-4.24 3.36a.75.75 0 01-.94 0L5.21 8.33a.75.75 0 01.02-1.12z"
                clip-rule="evenodd"/>
        </svg>
      </div>
    </div>
  </div>

  <p class="mt-2 text-sm text-slate-600">Estimate based on your current selection.</p>

  <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-6">
    <div class="rounded-xl bg-brand-50/60 border border-white p-4">
      <div class="text-xs uppercase tracking-wide text-slate-600">Rate</div>
      <div id="projRate" class="mt-1 text-xl font-semibold">—</div>
    </div>

    <div class="rounded-xl bg-slate-50/60 border border-white p-4">
      <div class="text-xs uppercase tracking-wide text-slate-600">Projected total</div>
      <div id="projTotal" class="mt-1 text-xl font-semibold">—</div>
    </div>
  </div>
</div>


    <!-- Recent activity -->
<div id="recentSkeleton" class="card p-6 mt-6">
  <div class="skel">
    <div class="skel-line h-5 w-40 mb-4"></div>
    <div class="space-y-3">
      <div class="skel-bar h-10"></div>
      <div class="skel-bar h-10"></div>
      <div class="skel-bar h-10"></div>
    </div>
  </div>
</div>

    <div id="activitySkeleton" class="card p-6 mt-6 hidden skel"></div>

<div id="activityContent" class="card p-0 mt-6 hidden">
  <!-- Header: title + legend (left), history link (right) -->
  <div class="px-6 pt-6 flex items-center justify-between">
    <div class="activity-header">
      <h2 class="text-lg font-semibold">Recent activity</h2>
      <!-- Legend is injected here by JS -->
      <div id="activityLegend" class="activity-legend-row"></div>
    </div>

    <a href="/pages/history.html" class="text-sm text-brand-700 hover:underline">
      View full history →
    </a>
  </div>

  <!-- Activity list (JS renders rows here) -->
  <div id="activityList" class="px-6 pt-2 pb-2"></div>

  <!-- Single footnote (JS will reuse/replace because of the data-attribute) -->
<p data-activity-footnote="1" class="act-footer">
  Click a row to view a receipt when available.
</p>

</div>


    <!-- Confirm modal -->
    <div id="confirmModal" class="hidden fixed inset-0 z-[100] flex items-center justify-center bg-black/40 p-4">
      <div class="card p-6 max-w-md w-full">
        <h3 id="confirmTitle" class="text-lg font-semibold">Confirm update</h3>
        <p id="confirmBody" class="mt-2 text-sm text-slate-600">This takes effect on your next billing date.</p>
        <div class="mt-6 flex justify-end gap-3">
          <button id="btnCancelConfirm" class="btn-light">Cancel</button>
          <button id="btnConfirmUpdate" class="btn-primary">Confirm</button>
        </div>
      </div>
    </div>

  </div>

  <!-- Scripts -->
  <script type="module" src="/js/shared/bootstrap.js"></script>
  <!-- Shim that imports /js/contribute/index.js -->
  <script type="module" src="/js/pages/contribute/index.js"></script>
  <!-- Keep navbar if needed -->
  <script type="module" src="/js/navbar/index.js"></script>
</body>
</html>
